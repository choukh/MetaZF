# Coq集合模型论(1-4): 无穷公理等价于宇宙存在

> Q群：893531731  
> [GitHub - choukh/MetaZF](https://github.com/choukh/MetaZF)  
> [总目录](https://zhuanlan.zhihu.com/p/524446016)

## 前置知识
- [SF第1卷](https://coq-zh.github.io/SF-zh/lf-current/toc.html)
- [Coq集合模型论(1-2): 累积层级与集合的秩](https://zhuanlan.zhihu.com/p/521339639)  
- [Coq集合模型论(1-3): 极限层与格罗滕迪克宇宙](https://zhuanlan.zhihu.com/p/527492919)  

## 无穷公理的表述

我们考虑无穷公理的一个变体: $V_{<ω}$ 存在, 记作 Infⱽ. 它蕴含 ω 存在, 记作 Infⱽ → Infʷ. 反方向的蕴含由传统教科书给出: 由 ω 可以递归定义 $V_{<ω}$. 总之, 我们的 Infⱽ 等价于传统的 Infʷ.

形式地, 由类型论丰富的表达能力, 我们可以定义元语言上的函数迭代.
```Coq
(* 元语言迭代 *)
Fixpoint 迭代 {A} (f : A → A) a n :=
  match n with
  | O => a
  | S m => f (迭代 f a m)
  end.
```

那么 $V_n$ 就是从空集开始的幂迭代, 所有这样的 $V_n$ 组成的类记作 $V_{<ω}$, 而 Infⱽ 就是说 $V_{<ω}$ 是集合.

```Coq
Definition Vₙ := 迭代 幂 ∅.

(* V_<ω 类 *)
Definition 有穷层 x := ∃ n, x = Vₙ n.

(* 无穷公理变体: V_<ω 类可集化 *)
Definition Infⱽ := setLike 有穷层.
```

其中 setLike "谓词"不过是以下句子的简写.

```Coq
Notation "A =ₚ P" := (∀ x, x ∈ A ↔ x ∈ₚ P) (at level 70).
Notation "'setLike' P" := (∃ A, A =ₚ P) (only parsing, at level 10).
```

## 宇宙蕴含无穷

**引理 1-4-1** 宇宙的存在性 (记作 Univ) 蕴含 Infⱽ.  

```Coq
(* 存在宇宙 *)
Definition Univ := ∃ u, 宇宙 u.

Lemma 宇宙蕴含无穷 : Univ → Infⱽ.
```

证明: 从 Univ 承诺的宇宙 u 中分离出有穷层 u', 它就是 Infⱽ 所需的见证有穷层 setLike 的集合. =ₚ的左到右由分离公理立即得证.

```Coq
Proof.
  intros [u U]. exists (u ∩ₚ 有穷层).
  intros x. split; intros H.
  - now apply 分离 in H.
```

=ₚ的右到左需证 $V_n ∈ u'$, 即证 $V_n ∈ u$ 且 $V_n$ 是有穷层, 后者即定义. 对前者, 对 n 归纳. n = 0 时由宇宙对空集的封闭性, n = S n 时由归纳假设和宇宙对幂集的封闭性得证. ∎

```Coq
  - destruct H as [n ->]. apply 分离. split. 2:now exists n.
    induction n. now apply 宇宙对空集封闭. now apply 宇宙对幂集封闭.
Qed.
```

## 无穷蕴含宇宙

本文的最终目标是证明 Univ 等价于 Infⱽ, 由上文可见左到右很简单, 但反方向比较繁琐, 我们分几个小节来讲.

### $V_ω$ 是极限层

由外延公理可知类的集合化 (如果存在的话) 是唯一的, 再结合 [(1-3)](https://zhuanlan.zhihu.com/p/527492919) 的唯一选择函数 δ 可证关于类集化的大消除.

```Coq
Lemma 集化唯一 P : uniqueness (λ A, A =ₚ P). (* 证明略 *)

Lemma 集化大消除 P : (∃ A, A =ₚ P) → Σ A, A =ₚ P. (* 证明略 *)
```

这样我们就可以提取出 Infⱽ 所承诺的 $V_{<ω}$ 并得到进一步的构造, 如它的并 $V_ω$.

```Coq
Hypothesis inf : Infⱽ.

(* V_<ω 集 *)
Definition Vltω := proj1_sig (集化大消除 inf).

(* Vltω =ₚ 有穷层 *)
Definition 无穷 := proj2_sig (集化大消除 inf).

Definition Vω := ⋃ Vltω.
```

**引理 1-4-2** $V_n$ 是层.  
证明: 对n归纳, 由层的定义得证. ∎

```Coq
Lemma Vn是层 n : Vₙ n ∈ₚ 层.
Proof. induction n. apply 空集层. now constructor. Qed.
```

**引理 1-4-3** $V_ω$ 是层.  
证明: 由层的定义只需证 $V_{<ω}$ ⊆ₚ 层. 由无穷公理可知 $V_{<ω}$ 里都是某 $V_n$, 而由上一条引理, $V_n$ 是层. ∎

```Coq
Lemma Vω是层 : Vω ∈ₚ 层.
Proof.
  constructor. intros y Y.
  apply 无穷 in Y as [n ->]. apply Vn是层.
Qed.
```

**引理 1-4-4** $V_n ∈ V_{<ω}$.  
证明: 由无穷公理立即得证. ∎

```Coq
Lemma Vn属Vltω n : Vₙ n ∈ Vltω.
Proof. apply 无穷. now exists n. Qed.
```

**引理 1-4-5** $V_n ∈ V_ω$.  
证明: $V_n ∈ V_{n^+} ∈ V_{<ω}$, 所以 $V_n ∈ ⋃ V_{<ω} = V_ω$. ∎

```Coq
Lemma Vn属Vω n : Vₙ n ∈ Vω.
Proof.
  apply 并集. exists (Vₙ (S n)).
  split. now apply 幂集. apply Vn属Vltω.
Qed.
```

**事实 1-4-6** $∅ ∈ V_ω$.  
证明: 因为 $V_0 = ∅, 且 V_0 ∈ V_ω$. ∎

```Coq
Lemma Vω对空集封闭 : ∅ ∈ Vω.
Proof. replace ∅ with (Vₙ 0) by reflexivity. apply Vn属Vω. Qed.
```

**引理 1-4-7** $x ∈ V_ω → ∃ n, x ∈ V_n$.  
证明: 由并集公理, 存在 $y$ 使得 $x ∈ y ∈ V_{<ω}$, 而 $y$ 是某 $V_n$. ∎

```Coq
Lemma Vω成员属某Vn x : x ∈ Vω → ∃ n, x ∈ Vₙ n.
Proof.
  intros [y [xy yV]] % 并集.
  apply 无穷 in yV as [n ->]. now exists n.
Qed.
```

**引理 1-4-8** $V_ω ⊆ ⋃ V_ω$.  
证明: 对任意 $x ∈ V_ω$, 存在某 $V_n$ 使得 $x ∈ V_n ∈ V_ω$, 所以 $x ∈ ⋃ V_ω$. ∎

```Coq
Lemma Vω之并 : Vω ⊆ ⋃ Vω.
Proof.
  intros x X. apply Vω成员属某Vn in X as [n X].
  apply 并集. exists (Vₙ n). split; trivial. apply Vn属Vω.
Qed.
```

**引理 1-4-9** $V_ω$ 是极限层.  
证明: 由极限层的定义, 引理 1-4-3 和引理 1-4-8 立即得证. ∎

```Coq
Lemma Vω是极限层 : Vω ∈ₚ 极限层.
Proof. split. apply Vω是层. apply Vω之并. Qed.
```

### 支线: $V_ω$ 是归纳集

我们知道原版的无穷公理表述为存在归纳集, 而由 Infⱽ 得到的 $V_ω$ 就给出了这样一个归纳集, 所以 Infⱽ 蕴含原版的无穷公理 (记作 Inf).

```Coq
Definition 归纳集 A := ∅ ∈ A ∧ ∀ a ∈ A, a⁺ ∈ A.

(* 无穷公理: 存在归纳集 *)
Definition Inf := Σ I, 归纳集 I.
```

**引理 1-4-10** x ∈ y → y ∈ₚ 层 → x⁺ ∈ 𝒫 y.  
证明: 即证对任意 z ∈ x⁺ 有 z ∈ y. 若 z = x, 改写前提得证. 若 z ∈ x, 由层的传递性得证. ∎

```Coq
Lemma 后继_升秩 x y : x ∈ y → y ∈ₚ 层 → x⁺ ∈ 𝒫 y.
Proof.
  intros xy yS. apply 幂集. intros z zx.
  apply 后继 in zx as [->|]. trivial. apply 层传递 with x; auto.
Qed.
```

**引理 1-4-11** $V_ω$ 是归纳集.  
证明: 

```Coq
Lemma Vω是归纳集 : 归纳集 Vω.
Proof.
  split. apply Vω对空集封闭.
  intros. apply Vω成员属某Vn in H as [n an].
  apply 并集. exists (Vₙ (S n)). split.
  - cbn. apply 后继_升秩. apply an. apply Vn是层.
  - apply Vn属Vltω.
Qed.
```

### 有穷集

